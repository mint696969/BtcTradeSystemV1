ğŸ“˜ BtcTradeSystem V1 ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼è¨­å®š ã‚¿ãƒ–è¿½åŠ ä»•æ§˜æ›¸ï¼ˆæ­£å¼ç‰ˆ / 2025-10-31ï¼‰
1. ç›®çš„

æœ¬ä»•æ§˜æ›¸ã¯ã€
æ–°ã—ã„æ©Ÿèƒ½ã‚¿ãƒ–ã‚’ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãŠã‚ˆã³è¨­å®šç”»é¢ã«è¿½åŠ ã™ã‚‹éš›ã®æ­£å¼æ‰‹é †ã¨ãƒ«ãƒ¼ãƒ«ã‚’å®šç¾©ã™ã‚‹ã€‚
ç›®çš„ã¯ä»¥ä¸‹ã®é€šã‚Šï¼š

GPT ãŒå˜ç‹¬ã§å®‰å…¨ã‹ã¤ä¸€è²«ã—ãŸå½¢ã§ã‚¿ãƒ–ã‚’è¿½åŠ ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚

é–‹ç™ºç›£æŸ»ï¼ˆDev-Auditï¼‰ãƒ»é‹ç”¨ç›£æŸ»ï¼ˆAuditï¼‰ãƒ»è¨­å®šæ›´æ–°ã®ãƒˆãƒ¬ãƒ¼ã‚µãƒ“ãƒªãƒ†ã‚£ã‚’ç¶­æŒã™ã‚‹ã€‚

ã‚³ãƒ¼ãƒ‰ä¿®æ­£ãªã—ã§è¿½åŠ ãƒ»å‰Šé™¤ãƒ»ä¸¦ã¹æ›¿ãˆãŒè¡Œãˆã‚‹æ§‹é€ ã‚’ä¿ã¤ã€‚

2. é©ç”¨ç¯„å›²
å¯¾è±¡	å†…å®¹
ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚¿ãƒ–	btc_trade_system/features/dash/ui_<name>.py
è¨­å®šã‚¿ãƒ–	btc_trade_system/features/settings/settings.py å†…ã§ç™»éŒ²ã•ã‚Œã‚‹ã‚µãƒ–ã‚¿ãƒ–
å…±é€šä¾å­˜	common/paths.py, common/settings.py, common/audit.py ç­‰
ç›£æŸ»è¨˜éŒ²å…ˆ	logs/audit.jsonl (é‹ç”¨ç›£æŸ») / logs/dev_audit.jsonl (é–‹ç™ºç›£æŸ»)
3. é–‹ç™ºãƒ«ãƒ¼ãƒ«éµå®ˆï¼ˆå…±é€šï¼‰

1ãƒ•ã‚¡ã‚¤ãƒ«ï¼1æ©Ÿèƒ½ï¼ˆã‚¿ãƒ–ã”ã¨ã«ç‹¬ç«‹ã—ãŸ .pyï¼‰

2è¡Œãƒ˜ãƒƒãƒ€å¿…é ˆ

# path: btc_trade_system/features/dash/ui_<name>.py
# desc: æ©Ÿèƒ½æ¦‚è¦ï¼ˆç›®çš„ã‚’ä¸€è¡Œã§ï¼‰


å‘½åè¦ç´„

ui_<name>.pyï¼šUI æç”»ç”¨

svc_<name>.pyï¼šãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ï¼ãƒ‡ãƒ¼ã‚¿å–å¾—ç”¨

common/ ä¾å­˜ã¯ import ã®ã¿ï¼ˆé€†ä¾å­˜ç¦æ­¢ï¼‰

ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆè¦ç´„

Streamlit UI ã¯ st.container() å˜ä½ã§æ§‹æˆã€‚

CSS ã¯ features/dash/styles/ å†…ã‹ã‚‰ã‚¤ãƒ³ãƒãƒ¼ãƒˆï¼ˆã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ç¦æ­¢ï¼‰ã€‚

è¨­å®šã‚¿ãƒ–ã¯ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³CSSå¯ï¼ˆå¤–éƒ¨CSSã‚’èª­ã¾ãªã„ï¼‰ã€‚

4. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆï¼ˆå†æ²ãƒ»å›ºå®šï¼‰
btc_trade_system/
â””â”€ features/
   â”œâ”€ dash/
   â”‚   â”œâ”€ dashboard.py        â† ã‚¿ãƒ–çµ±æ‹¬ï¼‹ãƒ˜ãƒƒãƒ€ãƒ¼ï¼‹âš™ï¸å…¥å£
   â”‚   â”œâ”€ ui_main.py          â† ãƒ¡ã‚¤ãƒ³ã‚¿ãƒ–
   â”‚   â”œâ”€ ui_health.py        â† å¥å…¨æ€§
   â”‚   â”œâ”€ ui_audit.py         â† é–‹ç™ºç›£æŸ»
   â”‚   â”œâ”€ ui_settings.py      â† è¨­å®šå…¥å£ï¼ˆãƒ¢ãƒ¼ãƒ€ãƒ«å‘¼ã³å‡ºã—ï¼‰
   â”‚   â””â”€ styles/             â† å¤–éƒ¨CSSç¾¤
   â”œâ”€ settings/
   â”‚   â””â”€ settings.py         â† è¨­å®šã‚¿ãƒ–çµ±æ‹¬ï¼ˆã‚µãƒ–ã‚¿ãƒ–ç™»éŒ²ï¼‰
   â”œâ”€ audit/ â€¦ å¥å…¨æ€§ãƒ»ç›£æŸ»ã‚³ã‚¢
   â””â”€ health/ â€¦ åé›†ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ»å¯è¦–åŒ–

5. ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚¿ãƒ–è¿½åŠ ãƒ«ãƒ¼ãƒ«
5.1 ã‚¿ãƒ–ç™»éŒ²å®£è¨€ãƒ•ã‚¡ã‚¤ãƒ«

config/ui/tabs.yaml

tabs:
  - key: main
    label: ãƒ¡ã‚¤ãƒ³
    module: btc_trade_system.features.dash.ui_main
    enabled: true
    order: 1
  - key: health
    label: å¥å…¨æ€§
    module: btc_trade_system.features.dash.ui_health
    enabled: true
    order: 2
  - key: audit
    label: é–‹ç™ºç›£æŸ»
    module: btc_trade_system.features.dash.ui_audit
    enabled: true
    order: 3
  - key: <new_key>
    label: <æ–°ã‚¿ãƒ–è¡¨ç¤ºå>
    module: btc_trade_system.features.dash.ui_<new_key>
    enabled: true
    order: <æ•´æ•°>


è¿½åŠ ã¯ 1 è¡Œè¿½è¨˜ ã®ã¿ã€‚

order ã§è¡¨ç¤ºé †ã‚’åˆ¶å¾¡ã€‚

enabled=false ã«ã™ã‚‹ã¨éè¡¨ç¤ºã€‚

5.2 ã‚¿ãƒ–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ä½œæˆ

features/dash/ui_<new_key>.py ã‚’æ–°è¦ä½œæˆã€‚

æœ€å°æ§‹é€ ä¾‹ï¼š

# path: btc_trade_system/features/dash/ui_sample.py
# desc: ã‚µãƒ³ãƒ—ãƒ«ã‚¿ãƒ–ï¼ˆå–å¼•çµ±è¨ˆãªã©ï¼‰

import streamlit as st
from btc_trade_system.common import audit

def render():
    st.subheader("Sample Tab")
    st.write("ã“ã“ã«å†…å®¹ã‚’å®Ÿè£…")
    audit.log_event("dash.tab.open", feature="sample")

5.3 è‡ªå‹•ãƒ­ãƒ¼ãƒ‰æ©Ÿæ§‹ï¼ˆdashboard.pyï¼‰

dashboard.py ã¯ tabs.yaml ã‚’å‹•çš„èª­è¾¼ã—ã€
module ãƒ‘ã‚¹ã‚’ importlib.import_module() ã§ãƒ­ãƒ¼ãƒ‰ã€‚
â†’ æ–°ã‚¿ãƒ–ã¯ç™»éŒ²ç›´å¾Œã‹ã‚‰è‡ªå‹•åæ˜ ã•ã‚Œã‚‹ã€‚

5.4 ç›£æŸ»èªå½™ï¼ˆå›ºå®šï¼‰
ã‚¤ãƒ™ãƒ³ãƒˆå	ç”¨é€”
dash.tab.register	ã‚¿ãƒ–ç™»éŒ²
dash.tab.open	ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé–‹ã„ãŸ
dash.tab.close	é–‰ã˜ãŸ
dash.tab.toggle	æœ‰åŠ¹åŒ–/ç„¡åŠ¹åŒ–å¤‰æ›´
6. è¨­å®šã‚¿ãƒ–è¿½åŠ ãƒ«ãƒ¼ãƒ«
6.1 æ§‹é€ 

è¨­å®šã‚¿ãƒ–ã¯ features/settings/settings.py ãŒçµ±æ‹¬ã€‚

å„ã‚µãƒ–ã‚¿ãƒ–ã¯å†…éƒ¨ç™»éŒ²ãƒªã‚¹ãƒˆã«è¿½è¨˜ã™ã‚‹ã€‚

6.2 ã‚µãƒ–ã‚¿ãƒ–ç™»éŒ²ä¾‹
# settings.py å†…ã® register_settings_tabs()

SETTINGS_TABS = [
    {"key": "basic", "label": "åŸºæœ¬", "module": "btc_trade_system.features.settings.basic"},
    {"key": "network", "label": "é€šä¿¡", "module": "btc_trade_system.features.settings.network"},
    {"key": "monitoring", "label": "ç›£è¦–/å¥å…¨æ€§", "module": "btc_trade_system.features.settings.monitoring"},
    {"key": "<new_key>", "label": "<æ–°è¨­å®šå>", "module": "btc_trade_system.features.settings.<new_key>"},
]

6.3 è¨­å®šUIãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ
# path: btc_trade_system/features/settings/<new_key>.py
# desc: æ–°ã—ã„è¨­å®šã‚¿ãƒ–ï¼ˆä¾‹ï¼šé€šçŸ¥è¨­å®šï¼‰

import streamlit as st
from btc_trade_system.common import settings, audit

def render():
    cfg = settings.load_ui("<new_key>")
    st.text_input("é€šçŸ¥é–“éš”(sec)", value=cfg.get("interval", 60), key="interval")
    if st.button("ä¿å­˜"):
        settings.save_ui("<new_key>", {"interval": st.session_state["interval"]})
        audit.log_event("settings.update", tab="<new_key>")

6.4 ä¿å­˜å…ˆãƒ»æ¤œè¨¼
é …ç›®	ä¿å­˜å…ˆ	æ¤œè¨¼
ç¾è¡Œè¨­å®š	config/ui/<tab>.yaml	Pydantic æ¤œè¨¼ (common/schemas.py)
æ—¢å®šå€¤	config/ui_defaults/<tab>.yaml	èª­å–å°‚ç”¨
å·®åˆ†è¡¨ç¤º	ä¿å­˜å‰ã«å·¦å³æ¯”è¼ƒãƒ€ã‚¤ã‚¢ãƒ­ã‚°	
æ¤œè¨¼ã‚¨ãƒ©ãƒ¼	st.error() ï¼‹ audit.log_event("settings.validate.fail")	
7. ç›£æŸ»é€£æºï¼ˆå…±é€šï¼‰
ç¨®åˆ¥	ã‚¤ãƒ™ãƒ³ãƒˆå	å†…å®¹
ã‚¿ãƒ–æ“ä½œ	dash.tab.open, dash.tab.close	é–‹é–‰
è¨­å®šæ“ä½œ	settings.update, settings.reset_key	ä¿å­˜ãƒ»å¾©å…ƒ
æ¤œè¨¼	settings.validate.fail	æ¤œè¨¼å¤±æ•—
å§”è­²	ui_settings.open/close	è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ«é–‹é–‰
è¿½åŠ 	dash.tab.register, settings.tab.register	æ–°ã‚¿ãƒ–ç™»éŒ²æ™‚

ã™ã¹ã¦ logs/audit.jsonl ã¾ãŸã¯ logs/dev_audit.jsonl ã«å‡ºåŠ›ã•ã‚Œã‚‹ã€‚

8. ã‚¿ãƒ–è¿½åŠ æ™‚ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆï¼ˆGPT ä½œæ¥­ãƒ†ãƒ³ãƒ—ãƒ¬ï¼‰

 æ–°è¦ ui_<name>.py ã‚’ features/dash/ ã«ä½œæˆ

 å…ˆé ­2è¡Œãƒ˜ãƒƒãƒ€è¨˜å…¥

 config/ui/tabs.yaml ã¸è¿½è¨˜

 ã‚¹ã‚¿ã‚¤ãƒ«è¦ç´ ã¯ features/dash/styles/ ã‚’åˆ©ç”¨

 audit.log_event("dash.tab.open") ã‚’1å›è¿½åŠ 

 å®Ÿè¡Œç¢ºèª â†’ æ–°ã‚¿ãƒ–ãŒãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«è¡¨ç¤º

 settings.py ã«å¿…è¦ãªè¨­å®šã‚¿ãƒ–ã‚’ç™»éŒ²ï¼ˆä»»æ„ï¼‰

 logs/audit.jsonl ã«ç™»éŒ²ã‚¤ãƒ™ãƒ³ãƒˆå‡ºåŠ›ã‚’ç¢ºèª

9. å—ã‘å…¥ã‚Œå®šç¾©ï¼ˆDoDï¼‰
åŒºåˆ†	åˆ¤å®šåŸºæº–
âœ… æ§‹æ–‡	flake8 / pylint è­¦å‘Šãªã—
âœ… ãƒ˜ãƒƒãƒ€	2è¡Œãƒ˜ãƒƒãƒ€ã‚ã‚Š
âœ… UI	Streamlit æç”»ã«æˆåŠŸ
âœ… ç›£æŸ»	ä¸»è¦ã‚¤ãƒ™ãƒ³ãƒˆè¨˜éŒ²æ¸ˆã¿
âœ… è¨­å®š	ä¿å­˜ãƒ»å¾©å…ƒãŒæ©Ÿèƒ½
âœ… ã‚¹ã‚¿ã‚¤ãƒ«	æŒ‡å®šCSSé©ç”¨ç¢ºèª
âœ… ä¾å­˜	core/common ã¸ã®é€†ä¾å­˜ãªã—
10. è¿½åŠ é–‹ç™ºæ™‚ã® GPT æŒ‡ç¤ºãƒ†ãƒ³ãƒ—ãƒ¬
æ–°ã—ã„ã‚¿ãƒ– "<tab_name>" ã‚’è¿½åŠ ã—ãŸã„ã€‚
ç›®çš„: <æ¦‚è¦>
ç¨®é¡: [dashboard | settings]
ã“ã®ä»•æ§˜æ›¸ã«åŸºã¥ã„ã¦ä½œæˆã—ã¦ã€‚


GPT ã¯ã“ã‚Œã‚’èª­ã¿ã€

æ­£ã—ã„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¸ ui_<tab_name>.py ã‚’ç”Ÿæˆ

tabs.yaml ã¾ãŸã¯ settings.py ã¸ç™»éŒ²

å¿…è¦ãª ç›£æŸ»ã‚³ãƒ¼ãƒ‰ã‚’å«ã‚ã¦å‡ºåŠ›ã™ã‚‹ã€‚

11. ä»Šå¾Œã®æ‹¡å¼µæ–¹é‡

è‡ªå‹•ã‚¹ã‚­ãƒ£ãƒ•ã‚©ãƒ¼ãƒ«ãƒ‰ï¼šPowerShell tools/make_tab.ps1 ã«ã‚ˆã‚Šã€é››å½¢ï¼‹ç™»éŒ²ã‚’è‡ªå‹•ç”Ÿæˆã€‚

å›½éš›åŒ–å¯¾å¿œï¼šconfig/i18n_ja.json ã‚­ãƒ¼è‡ªå‹•ç”Ÿæˆã€‚

ã‚¿ãƒ–ä¾å­˜é–¢ä¿‚ç®¡ç†ï¼šdepends_on ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ äºˆå®šã€‚

CI æ¤œæŸ»ï¼šãƒ˜ãƒƒãƒ€ãƒ»å‘½åãƒ»ç›£æŸ»èªå½™é•åã‚’è‡ªå‹•ãƒã‚§ãƒƒã‚¯ã€‚

ç­–å®šæ—¥: 2025-10-31
è²¬ä»»åŒºåˆ†: Dashboard / Settings Team
éµå®ˆå¯¾è±¡: UI é–‹ç™ºå…¨ä½“ï¼ˆGPT å«ã‚€ï¼‰
ç›®çš„: æ©Ÿèƒ½è¿½åŠ ã®å®Œå…¨è‡ªå‹•åŒ–ã¨æ§‹é€ ä¸€è²«æ€§ç¶­æŒ